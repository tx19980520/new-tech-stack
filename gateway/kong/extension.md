# Extension

相较于其他的一些普适功能而言，extension 显得尤为的重要，这涉及到一些项目的主流开发问题以及日后的可持续发展的问题。

目前浅显的调研发现，Kong 的扩展能力主要依托的是 Nginx 的可扩展能力，Nginx 目前支持的可扩展方式有如下几类：

Lua: 非常老牌且非常常用的 Nginx 扩展方式，使用多年，有大量积累，虽然是脚本语言，但是性能上大约是在C/C++ 的 1/30 左右，

Golang：就 Golang 而言，实际是通过 Golang 编译出的 so 文件，再通过 lua 脚本进行 load so ，这样在性能上肯定是优于使用纯 Lua 的。

NGINX JavaScript：这似乎是一种替代 Lua 的方法，Nginx 没有引入 V8，而是ECMAScript标准的定制实现，专门针对NGINX和NGINX Plus设计。Node.js在内存中具有持久的JavaScript虚拟机（VM），并执行常规的垃圾回收以进行内存管理，而NGINX JavaScript会为每个请求初始化新的JavaScript VM和必需的内存，并在请求完成后释放内存。这一点上，感觉其并不是一个很成熟的方案，仅仅支持了一些语法。

这里其实可以考虑，直接引入 wasm 的虚拟机，来进行可扩展内容的操作。

wasm 在边缘的优点：

跨平台：边缘领域存在的运算资源类型五花八门，如果使用 so 文件，将需要进行多平台编译，在移植层面上存在问题

存储：wasm 目前可以支持 oci，在大规模部署和更新的情况下，wasm 比 so 更有利。

安全性：因为如果需要商业化，多租户的需求下需要更好的隔离性，因此使用 wasm 可以天然拥有隔离性。

当然在 wasm 中引入 WASM runtime 需要一定的工作量和相当的复杂问题需要解决。

Kong 现在开源支持和商业支持做得好，一定程度上是因为可扩展做得好，有很多可扩展库可以非常简单就使用。

看到这个 Lua 我有很深的恐惧，觉得并不好维护。