# etcd

## etcd简介&为何使用etcd

etcd 是一个分布式键值对存储，设计用来可靠而快速的保存关键数据并提供访问。通过分布式锁，leader选举和写屏障(write barriers)来实现可靠的分布式协作。etcd集群是为高可用，持久性数据存储和检索而准备。

那么凭借etcd在kube的社区里面的红火，能否在kubernetes的集群中取代redis来进行相应session服务的提供呢。

不能，主流观点如下：

1. redis的在读写方面的吞吐量打，性能上更加好于etcd。
2. etcd强调了租约特性，即在某lease发出之后，会保证在lease的有效期内不会改变数据，这样数据是将保证一致性，但是修改相应数据时，需要阻塞所有的请求，此时解决方式是读请求到来时，直接返回数据，但是不颁发lease，即不保证读到的是最新的数据。（简而言之就是是在一定时间之内的一个cut截断机制，更具体的描述可以查看[这里](https://www.jianshu.com/p/e7f1cb23ce0d)）整体上来讲这样的性能是远不如redis
3. redis中存在丰富的数据类型，但是etcd是没有的

我们知道etcd存在一些性能上的问题，我们能不能用redis取代etcd呢

不能，主流观点如下：

1. redis没有版本的概念，但是我们在实际的过程中可能需要更多的是回滚机制，etcd存在版本控制，可以即时的回滚。
2. redis主从为异步复制模式，一致性无法保证，只能说用于缓存等非一致性需求
3. etcd遵循raft协议（详细的动画介绍在[这里](http://thesecretlivesofdata.com/raft/)），能够保证数据的一致性和容错性，因为etcd的主要适用场景为配置管理和服务发现，也并不需要非常大的throughput，保证一致性是必要的。

综上所述，etcd和redis两者之间除去分布式和KV键值对存储之外，在用途和是实现上都是不相同的，我们需要分清楚，他们的使用是不相同的。

### etcd的主要使用类型

1. 服务发现
2. 系统配置

例如： calico和flannel的相关元数据和mac地址的存储

### redis的主要使用类型

1. session
2. 缓存
3. 队列