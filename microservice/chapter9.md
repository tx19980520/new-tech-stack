# 安全

本章主要论述的问题是围绕着authentication和authority展开。

首先，就网关的职责问题，本书作了进一步的讨论

> 如果我们决定把身份认证的责任移到网关，那么孤立地在微服务中定位问题就变得更难。
>
> 这种方法的最后一个问题是，它会给你一种虚假的安全感。
>
> 网关层承担越来越多的功能后，最终本身回事一个庞大的耦合点。

这里我们就要讲到粗细粒度鉴权，我们可以让网关能够做到，让未登录用户重定向到登录页面，组织未登录用户对内部接口的访问。而涉及到用户角色方面的问题(ACL)，我们应当由具体的微服务进行处（强调这里我们在讨论的是用户和整个系统之间的边界）。

默认的我们认为集群内部各个服务之间只要是正确形式的调用，都认为是正确的调用，但这会带来相关问题的出现，比如我们如何组织查询不属于本人的订单信息。我们通过查询个人信息查询订单信息，应当是用户服务调用订单服务的API，在用户服务内部我们相信已经进行了鉴权，但是对于调用其他服务的问题。

书中提出了两种解决方案：

携带状态的请求的转移，应当是将用户状态一并转发给订单服务，让订单服务内部自行定夺，但是这样对于凭证的解析将是多次出现（对于一些技术而言似乎有问题），但是如果我们使用的JWT，当request进入到进群内之后，JWT的正确性已经由gateway所验证，即payload的信息可以直接使用，则多次解析确可以简化为单次解析。

业务逻辑集中体现在用户服务，即用户服务先查询该订单是否是本人订单，之后再进行订单详情消息的查询，多一次网络调用，少一些用户信息的传递。



